<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>pvsneslib: games/likemario/LikeMario.c</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="docs.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">pvsneslib
   &#160;<span id="projectnumber">0.3.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">games/likemario/LikeMario.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><span class="comment">/*---------------------------------------------------------------------------------</span>
<span class="comment"></span>
<span class="comment"></span>
<span class="comment">    Simple tile mode 1 with scrolling demo</span>
<span class="comment">    -- alekmaul</span>
<span class="comment"></span>
<span class="comment"></span>
<span class="comment">---------------------------------------------------------------------------------*/</span>
<span class="preprocessor">#include &lt;<a class="code" href="a00024.html" title="the master include file for snes applications.">snes.h</a>&gt;</span>

<span class="preprocessor">#include &quot;soundbank.h&quot;</span>
<span class="keyword">extern</span> <span class="keywordtype">char</span> __SOUNDBANK__;

<span class="keyword">extern</span> <span class="keywordtype">char</span> jumpsnd,jumpsndend;

<span class="keyword">extern</span> <span class="keywordtype">char</span> mapgfx, mapgfx_end;
<span class="keyword">extern</span> <span class="keywordtype">char</span> mappal;
<span class="keyword">extern</span> <span class="keywordtype">char</span> map;
<span class="keyword">extern</span> <span class="keywordtype">char</span> mariogfx, mariogfx_end;
<span class="keyword">extern</span> <span class="keywordtype">char</span> mariopal;
<span class="keyword">extern</span> <span class="keywordtype">char</span> mapcol;

<span class="keyword">extern</span> <span class="keywordtype">char</span> snesfont;

<span class="comment">// Mario sprite</span>
<span class="keyword">typedef</span> <span class="keyword">struct</span>
{
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, y;
    <span class="keywordtype">int</span> jmpval;
    <span class="keywordtype">int</span> anim_frame;
    <span class="keywordtype">int</span> flipx;
} Mario;

<span class="comment">// Mario tiles</span>
<span class="keyword">enum</span> {MARIODOWN = 0, MARIOJUMPING = 1, MARIOWALK = 2, MARIOSTAND = 6};

<span class="preprocessor">#define GRAVITY 48</span>
<span class="preprocessor"></span><span class="preprocessor">#define JUMPVALUE (GRAVITY*20)</span>
<span class="preprocessor"></span>
<span class="keyword">enum</span> MarioState {W_JUMP = 1, W_RIGHT = 2,  W_LEFT = 3};

<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> scrX=0, idxScr=0, idFlip=0;  <span class="comment">// for screen scrolling</span>
Mario mario;   <span class="comment">// Our hero :D !</span>

<a name="_a0"></a><a class="code" href="a00016.html" title="Sound header(8 bytes)">brrsamples</a> Jump; <span class="comment">// The sound for jumping</span>

<span class="comment">//---------------------------------------------------------------------------------</span>
u16 getCollisionTile(u16 x, u16 y) {
    u16 *ptrMap = (u16 *) &amp;mapcol + (y&gt;&gt;3)*300 + (x&gt;&gt;3);
    
    <span class="keywordflow">return</span> (*ptrMap);
}

<span class="comment">//---------------------------------------------------------------------------------</span>
<span class="keywordtype">void</span> moveLevel(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> direction) {
    <span class="keywordtype">int</span> i;
    u16 *ptrMap;
    u16 ptrVRAM; 
    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sx;
    
    <a name="a1"></a><a class="code" href="a00028.html#a09d7fb089889aaa434f7c88ebccb5190" title="VRAM Address Increment Mode (W) 7 Increment VRAM Address after accessing High/Low byte (0=Low...">REG_VMAIN</a> = VRAM_INCHIGH | <a name="a2"></a><a class="code" href="a00028.html#a5623bfd6fefb79d4f21d260b7e333523acbbc69e337e06fc13a5f572284c5ddfe" title="Address Translation (0..3 = 0bit/None, 8bit, 9bit, 10bit)">VRAM_ADRTR_0B</a> | <a name="a3"></a><a class="code" href="a00028.html#a5623bfd6fefb79d4f21d260b7e333523acfee058cf30c9aacc05573725e3775d8" title="Address Increment Step (0..3 = Increment Word-Address by 1,32,128,128)">VRAM_ADRSTINC_1</a>; <span class="comment">// set address in VRam for read or write ($2116) + block size transfer ($2115)</span>
    <a name="a4"></a><a class="code" href="a00028.html#a962038681293a309df2c26f1e9a7d7e9" title="VMADDL - VRAM Address (lower 8bit) (W) VMADDH - VRAM Address (upper 8bit) (W)">REG_VMADDLH</a> = 0x1000;
    
    <span class="keywordflow">if</span> (direction == W_RIGHT) {
        scrX++; 
        <span class="keywordflow">if</span> ( (scrX &amp;7) == 0) { <span class="comment">// to avoid to bee too slow</span>
            <span class="comment">//*(unsigned char *) 0x2115 = 0x80;</span>
            sx = (scrX&gt;&gt;3) &amp; 63;
            sx = (sx + 32);
            <span class="keywordflow">if</span> (sx&gt;63) 
                sx = sx - 64;
            <span class="keywordflow">else</span>
                sx = (sx-32) + 32*32;
            ptrVRAM = 0x1000 + sx; <span class="comment">// screen begin to 0x1000</span>
            ptrMap  = (u16 *)  &amp;map + (scrX &gt;&gt; 3) + 32; 
            <span class="comment">// Copy the line in the background but need to wait VBL period</span>
            <a name="a5"></a><a class="code" href="a00021.html#a03304aaf535795c2857e357e028cdebe" title="macro to wait the VBL flag OK">WaitVBLFlag</a>;
            <span class="keywordflow">for</span> (i=0;i&lt;16;i++) {
                u16 value = *ptrMap;
                *(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *) 0x2116 = ptrVRAM;
                *(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *) 0x2118 = value ;
                ptrVRAM += 32;
                ptrMap += 300;
            }
        }
    }
    <span class="comment">// scroll to the left</span>
    <span class="keywordflow">else</span> {
        scrX--; 
        <span class="keywordflow">if</span> ( (scrX &amp;7) == 0) { <span class="comment">// to avoid to bee too slow</span>
            <span class="keywordflow">if</span> (scrX) { <span class="comment">// to avoid doing some for 1st tile </span>
                <span class="comment">//*(unsigned char *) 0x2115 = 0x80;</span>
                sx = (scrX&gt;&gt;3) &amp; 63;
                sx = (sx - 1);
                <span class="keywordflow">if</span> (sx&lt;0) sx = sx + 64;
                <span class="keywordflow">if</span> (sx&gt;31) sx = (sx-32) + 32*32;
                ptrVRAM = 0x1000 + sx; <span class="comment">// screen begin to 0x1000</span>
                ptrMap  = (u16 *)  &amp;map + (scrX &gt;&gt; 3) - 1; 
                <span class="comment">// Copy the line in the background but need to wait VBL period</span>
                <a class="code" href="a00021.html#a03304aaf535795c2857e357e028cdebe" title="macro to wait the VBL flag OK">WaitVBLFlag</a>;
                <span class="keywordflow">for</span> (i=0;i&lt;16;i++) {
                    u16 value = *ptrMap;
                    *(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *) 0x2116 = ptrVRAM;
                    *(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *) 0x2118 = value ;
                    ptrVRAM += 32;
                    ptrMap += 300;
                }
            }
        }
    }

    <span class="comment">// now scroll with current value</span>
    <a name="a6"></a><a class="code" href="a00018.html#aa5e0112ea2d4b514c2dddc6ed2c7c3c7" title="Sets the scroll hardware to the specified location.">bgSetScroll</a>(1,scrX,0);
}

<span class="comment">//---------------------------------------------------------------------------------</span>
<span class="keywordtype">void</span> moveMario(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> padvalue) {
    <span class="comment">// Update scrolling with current pad (left / right / jump can combine)</span>
    <span class="keywordflow">if</span> (padvalue &amp; (<a name="a7"></a><a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d" title="pad RIGHT button.">KEY_RIGHT</a> | <a name="a8"></a><a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65" title="pad LEFT button.">KEY_LEFT</a> | <a name="a9"></a><a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072aa7b3a3d0503a46bec51c6e3da95747cc" title="pad A button.">KEY_A</a>) ) {
        <span class="keywordflow">if</span> (padvalue &amp; <a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072a6504370d9c6391e1a9da6a1a529b089d" title="pad RIGHT button.">KEY_RIGHT</a>) { 
            <span class="comment">// if we can go right</span>
            <span class="keywordflow">if</span> (getCollisionTile(scrX+(mario.x&gt;&gt;8)+16, (mario.y&gt;&gt;8)) == 0) {
                <span class="comment">// if when are less than screen center, let&#39;s go</span>
                <span class="keywordflow">if</span> (mario.x&lt;(128&lt;&lt;8)) { <span class="comment">// If mario coord is not center</span>
                    mario.x+=256;
                }
                <span class="comment">// else if screen can scroll (width minus one screen)</span>
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scrX&lt;(300*8-32*8)) {
                    moveLevel(W_RIGHT);
                }
                <span class="comment">// else, can go if not on right of screen</span>
                <span class="keywordflow">else</span>  {
                    <span class="keywordflow">if</span> (mario.x&lt;(255&lt;&lt;8)) mario.x+=256;
                }
                mario.flipx=1;
            }
        }
        <span class="comment">// Else it&#39;s perhaps left :)</span>
        <span class="keywordflow">if</span> (padvalue &amp; <a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072a612120b69c7dfd46086db7aaebdbcf65" title="pad LEFT button.">KEY_LEFT</a>)  {
            <span class="comment">// can we go left ?</span>
            <span class="keywordflow">if</span> ((scrX+(mario.x&gt;&gt;8)-1&gt;0) &amp;&amp; (getCollisionTile(scrX+(mario.x&gt;&gt;8)-1, (mario.y&gt;&gt;8)) == 0)) { 
                <span class="comment">// if we are on the right of the screen, go to center</span>
                <span class="keywordflow">if</span> (mario.x&gt;(128&lt;&lt;8)) {
                    mario.x-=256;
                }
                <span class="comment">// else if screen can scroll</span>
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (scrX&gt;0) {
                    moveLevel(W_LEFT);
                }
                <span class="comment">// else, can go if not on mleft of screen</span>
                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mario.x&gt;(0&lt;&lt;8)) {
                    mario.x-=256;
                }
                mario.flipx=0;
            }
        }
        <span class="comment">// Hum, no perhaps jumping \o/</span>
        <span class="keywordflow">if</span> (padvalue &amp; <a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072aa7b3a3d0503a46bec51c6e3da95747cc" title="pad A button.">KEY_A</a>) {
            <span class="comment">// can jump ??</span>
            <span class="keywordflow">if</span> (getCollisionTile(scrX+(mario.x&gt;&gt;8), (mario.y&gt;&gt;8)+16) != 0) {
                mario.jmpval = -JUMPVALUE;
                mario.anim_frame = MARIOJUMPING;
                <a name="a10"></a><a class="code" href="a00026.html#a8e5286554841ea48b028b4b782364ab0" title="Play sound from memory (using default arguments)">spcPlaySound</a>(0);
            }
        }

        <span class="comment">// Update frame if not jumping</span>
        <span class="keywordflow">if</span> (mario.anim_frame != MARIOJUMPING) {
            <span class="keywordflow">if</span> ((mario.anim_frame&lt;MARIOWALK) || (mario.anim_frame == MARIOSTAND)) {
                mario.anim_frame = MARIOWALK;
            }
            <span class="keywordflow">else</span> {
                mario.anim_frame++;
                <span class="keywordflow">if</span>(mario.anim_frame &gt;= MARIOSTAND) mario.anim_frame = MARIOWALK;
            }
        }
    }
    <span class="comment">// down to have small mario</span>
    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (padvalue &amp; <a name="a11"></a><a class="code" href="a00023.html#aa27cad8fa018a58930b6622783a83072aa9cdac7967bf7d88fdb761138a2a3416" title="pad DOWN button.">KEY_DOWN</a>) {
        mario.anim_frame = MARIODOWN;
    }
    <span class="comment">// well, no pad value, so just standing !</span>
    <span class="keywordflow">else</span> {
        <span class="keywordflow">if</span> (mario.anim_frame != MARIOJUMPING) mario.anim_frame = MARIOSTAND;
    }

    <span class="comment">// if can jump, just do it !</span>
    <span class="keywordflow">if</span> (getCollisionTile((scrX+(mario.x&gt;&gt;8)+8), ((mario.y&gt;&gt;8)+16)) == 0) {
        mario.jmpval += GRAVITY;
    }

    <span class="comment">// Add jumping value if needed</span>
    mario.y += mario.jmpval;
    
    <span class="comment">// Again test collsion with ground</span>
    <span class="keywordflow">if</span> (getCollisionTile((scrX+(mario.x&gt;&gt;8)+8), ((mario.y&gt;&gt;8)+16)) != 0) {
        <span class="keywordflow">if</span> (mario.jmpval) {
            mario.jmpval = 0;
            mario.anim_frame = MARIOSTAND;
        }
    }
    
    <span class="comment">// To avoid being in floor</span>
    <span class="keywordflow">while</span> (getCollisionTile((scrX+(mario.x&gt;&gt;8)+8), ((mario.y&gt;&gt;8)+15))) {
        mario.y -= 128; 
        mario.jmpval = 0;
    }
}

<span class="comment">//---------------------------------------------------------------------------------</span>
<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {
    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pad0, move, i;

    <span class="comment">// Initialize sound engine (take some time)</span>
    <a name="a12"></a><a class="code" href="a00026.html#ad8753cb6edb38834257bbf0020700689" title="boots the spc700 with sm-spc. call once at startup">spcBoot</a>();
    
    <span class="comment">// Initialize SNES </span>
    <a name="a13"></a><a class="code" href="a00019.html#a6047713bb5a73afd3cd1d77e336bcdad" title="Initialize console.">consoleInit</a>();
    
    <span class="comment">// Set give soundbank</span>
    <a name="a14"></a><a class="code" href="a00026.html#ab68840ba8aab786b8ea206ea077acaac" title="set soundbank origin. soundbank must have dedicated bank(s)">spcSetBank</a>(&amp;__SOUNDBANK__);
    
    <span class="comment">// allocate around 10K of sound ram (39 256-byte blocks)</span>
    <a name="a15"></a><a class="code" href="a00026.html#a2113060be24b307d1e03f167eb241b90" title="set the size of the sound region (this must be big enough to hold your longest/largest sound) this fu...">spcAllocateSoundRegion</a>(39);

    <span class="comment">// Load music</span>
    <a name="a16"></a><a class="code" href="a00026.html#a313e30fb1962df9fb469f2fedd4d91e4" title="load module into sm-spc. this function may take some time to execute">spcLoad</a>(MOD_OVERWORLD);
    
    <span class="comment">// Load sample</span>
    <a name="a17"></a><a class="code" href="a00026.html#a4ef9d5d4b7618a2e091194b6c17f75a5" title="set the address of the SOUND TABLE">spcSetSoundEntry</a>(15, 8, 6, &amp;jumpsndend-&amp;jumpsnd, &amp;jumpsnd, &amp;Jump);
    
    <span class="comment">// Initialize text console with our font and invert color (black with BG white)</span>
    <a name="a18"></a><a class="code" href="a00019.html#a458fa049800e12429ca0ba401e513746" title="Initialize the Text System.">consoleInitText</a>(0, 1, &amp;snesfont);
    <a name="a19"></a><a class="code" href="a00019.html#ac0993a72682f86d17784a7f4659562de" title="Change Character and Background color of text.">consoleSetTextCol</a>(<a name="a20"></a><a class="code" href="a00028.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(0,0,0), <a class="code" href="a00028.html#abd4530c7880d389c9ea70e2e3b84aa9d" title="Macro to convert 5 bit r g b components into a single 15 bit RGB triplet.">RGB15</a>(31,31,31));
    
    <span class="comment">// Copy tiles to VRAM</span>
    <a name="a21"></a><a class="code" href="a00018.html#ae09a7ac09be78eef0f28a6c7aabc82ad" title="Initializes a Tile Set and Loads the Tile GFX into VRAM.">bgInitTileSet</a>(1, &amp;mapgfx, &amp;mappal, 0, (&amp;mapgfx_end - &amp;mapgfx), 16*2, BG_16COLORS, 0x5000);

    <span class="comment">// Init Sprites gfx and palette with default size of 16x16</span>
    <a name="a22"></a><a class="code" href="a00027.html#af35cb9aafcffa5cce45c6c609950360d" title="Initializes a sprites Gfx and Loads the GFX into VRAM.">oamInitGfxSet</a>(&amp;mariogfx, (&amp;mariogfx_end-&amp;mariogfx), &amp;mariopal, 0, 0x4000, <a name="a23"></a><a class="code" href="a00027.html#a35664c2c4a66c3bac8139ae093d7f3ac" title="default OAM size 16x16 pix for OBJSEL register">OBJ_SIZE16</a>);

    <span class="comment">// Init Map to address 0x1000 and Copy Map to VRAM</span>
    <a name="a24"></a><a class="code" href="a00018.html#a4fcbdb4b2378a64e8db62a184ee1851e" title="Change Background Map address.">bgSetMapPtr</a>(1, 0x1000, <a name="a25"></a><a class="code" href="a00018.html#a7afc211c644079338a1f032ea5e90460a6018515bdd851349b699d0cb20dd23de" title="64 x 32 tile size">SC_64x32</a>);
    <span class="keywordflow">for</span> (i=0;i&lt;31;i++) { <span class="comment">// 128 pixel height -&gt; 128/8 = 16 2400 / 8 = 300</span>
        u8 *ptrMap  = &amp;map + 300*i*2; <span class="comment">// 300 = map size x *2 because each entry is 16bits length</span>
        <span class="keywordflow">if</span> (i&gt;=16) ptrMap  = &amp;map + 300*5*2; <span class="comment">// Init anything else with white line</span>
        u16 ptrVRAM = 0x1000+i*32; <span class="comment">// screen begin to 0x1000</span>
        <a name="a26"></a><a class="code" href="a00020.html#aaf545b3f811f6ef4b7c4be434701a77a" title="copies data from source to destination using channel 0 of DMA available channels in half words...">dmaCopyVram</a>(ptrMap, ptrVRAM, 32*2); <span class="comment">// copy row to VRAM </span>
        <a class="code" href="a00020.html#aaf545b3f811f6ef4b7c4be434701a77a" title="copies data from source to destination using channel 0 of DMA available channels in half words...">dmaCopyVram</a>((ptrMap+32*2), (ptrVRAM+32*32), 32*2); <span class="comment">// copy row to VRAM </span>
    }

    <span class="comment">// Show Mario</span>
    mario.x = 32&lt;&lt;8; mario.y = 96&lt;&lt;8; <span class="comment">// 128-16-16 = 96, 16 because map ground is 16 pix height, in fixed point</span>
    mario.anim_frame = MARIOSTAND; mario.flipx = 1; mario.jmpval = 0;
    <a name="a27"></a><a class="code" href="a00027.html#af18394510c04f64df05cfa40f6ac2e82" title="sets an oam entry to the supplied values">oamSet</a>(0,  (mario.x&gt;&gt;8), (mario.y&gt;&gt;8), 3, mario.flipx, 0, mario.anim_frame*2, 0);  <span class="comment">// flip x and take 5th sprite</span>
    <a name="a28"></a><a class="code" href="a00027.html#a5d4feec9383252798023c83f9a65e1ef" title="Put the correct size and hide or not a oam.">oamSetEx</a>(0, OBJ_SMALL, OBJ_SHOW);
    
    <span class="comment">// Now Put in 16 color mode and disable BG3</span>
    <a name="a29"></a><a class="code" href="a00028.html#ad38541ebb0ff0ae46d99f4c5d3288c4d" title="Set the SNES hardware to operate in new display mode.">setMode</a>(<a name="a30"></a><a class="code" href="a00018.html#a7afc211c644079338a1f032ea5e90460adce05b1d024af3f279a6bc8050b76269" title="16-color 16-color 4-color - ;Normal">BG_MODE1</a>,0);  <a name="a31"></a><a class="code" href="a00018.html#a4dbfb1b8854ff9ca4a7d11a899281bbb" title="Disable a BG in the actual SNES mode.">bgSetDisable</a>(2);
    
    <span class="comment">// Put some text</span>
    <a name="a32"></a><a class="code" href="a00019.html#a7e52d15b5a1befa42f5758de19dfb70c" title="Output formatted string on a screen (tiles mode)">consoleDrawText</a>(6,16,<span class="stringliteral">&quot;MARIOx00  WORLD TIME&quot;</span>);
    <a class="code" href="a00019.html#a7e52d15b5a1befa42f5758de19dfb70c" title="Output formatted string on a screen (tiles mode)">consoleDrawText</a>(6,17,<span class="stringliteral">&quot; 00000 ox00 1-1  000&quot;</span>);
    
    <span class="comment">// Play file from the beginning</span>
    <a name="a33"></a><a class="code" href="a00026.html#aebf91de1df5e4fa83454a84bb0e60918" title="play module. note: this simply queues a message, use spcFlush if you want to wait until the message i...">spcPlay</a>(0);<a name="a34"></a><a class="code" href="a00026.html#ae2c8dfab62ceecf5c302c95f5453a752" title="set the module playback volume">spcSetModuleVolume</a>(100);
    
    <span class="comment">// Wait VBL &#39;and update sprites too ;-) )</span>
    <a name="a35"></a><a class="code" href="a00021.html#a815e2626bd26d0e936d507a363ecd723" title="Wait for vblank interrupt Waits for a vertical blank interrupt.">WaitForVBlank</a>();
    
    <span class="comment">// Wait for nothing :P</span>
    <span class="keywordflow">while</span>(1) {
        <span class="comment">// no move currently</span>
        move = 0;
        
        <span class="comment">// Refresh pad values</span>
        <a name="a36"></a><a class="code" href="a00023.html#a4a6674dce70032b45e5b3ba10e515012" title="Wait for pad ready and read pad values in .">scanPads</a>();
        
        <span class="comment">// Get current #0 pad</span>
        pad0 = <a name="a37"></a><a class="code" href="a00023.html#a5ff772be839fa2e5602e4aa9955ee0d7" title="Return current value of selected pad.">padsCurrent</a>(0);
        
        <span class="comment">// update mario regarding pad value</span>
        moveMario(pad0);
        
        <span class="comment">// Now, display mario with current animation</span>
        <a class="code" href="a00027.html#af18394510c04f64df05cfa40f6ac2e82" title="sets an oam entry to the supplied values">oamSet</a>(0,  (mario.x&gt;&gt;8), (mario.y&gt;&gt;8), 3, mario.flipx, 0, mario.anim_frame*2, 0);
        
        <span class="comment">// Update sound and wait VBL</span>
        <a name="a38"></a><a class="code" href="a00026.html#acab7d87110bac6baa9d74ab314772c98" title="Process messages This function will try to give messages to the spc until a few scanlines pass...">spcProcess</a>();
        <a class="code" href="a00021.html#a815e2626bd26d0e936d507a363ecd723" title="Wait for vblank interrupt Waits for a vertical blank interrupt.">WaitForVBlank</a>();
    }
    <span class="keywordflow">return</span> 0;
}
</pre></div> </div><!-- contents -->


<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 6 2012 08:22:04 for pvsneslib by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.0
</small></address>

</body>
</html>
